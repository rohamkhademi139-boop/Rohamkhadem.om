<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>فروشگاه تک‌فایل پیشرفته - Roham</title>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700&display=swap');

        :root {
            --primary-color: #007bff;
            --secondary-color: #0056b3;
            --text-color: #333;
            --bg-color: #f8f9fa;
            --card-bg: #fff;
            --success-color: #28a745;
            --danger-color: #dc3545;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Vazirmatn', Tahoma, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
        }

        /* بخش‌های مخفی (Admin, Cart, Checkout) */
        .page-content {
            display: none;
        }

        .page-content.active {
            display: block;
        }

        /* نوار ناوبری (Navbar) */
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: var(--card-bg);
            padding: 15px 50px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .logo {
            font-size: 1.8em;
            font-weight: 700;
            color: var(--primary-color);
            cursor: pointer;
        }

        .navbar nav a {
            text-decoration: none;
            color: var(--text-color);
            margin: 0 15px;
            font-weight: 400;
            transition: color 0.3s;
            cursor: pointer;
        }
        
        /* دکمه‌ها و فرم‌ها */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.3s;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-success {
            background-color: var(--success-color);
            color: white;
        }

        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--secondary-color);
        }

        .cart-btn {
            background-color: #f7a01d;
            color: white;
            margin-right: 10px;
        }

        .container {
            max-width: 1200px;
            margin: 30px auto;
            padding: 0 20px;
        }

        h2 {
            text-align: center;
            margin-bottom: 30px;
            color: var(--secondary-color);
        }

        /* شبکه محصولات */
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-bottom: 50px;
        }

        .product-card {
            background-color: var(--card-bg);
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            overflow: hidden;
            text-align: center;
            transition: transform 0.3s;
        }

        .product-card img {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }

        .product-card .price {
            font-size: 1.4em;
            font-weight: 700;
            color: var(--danger-color);
            margin: 15px 0;
        }
        
        /* بخش سبد خرید و پرداخت */
        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #eee;
        }

        .cart-item img {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 5px;
            margin-left: 15px;
        }

        .item-info {
            flex-grow: 1;
        }

        .item-quantity input {
            width: 50px;
            text-align: center;
            margin: 0 10px;
        }
        
        .checkout-summary {
            background-color: #e9ecef;
            padding: 20px;
            border-radius: 8px;
            margin-top: 30px;
        }

        .checkout-summary div {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            font-size: 1.1em;
        }

        .checkout-summary .total {
            font-size: 1.5em;
            font-weight: 700;
            color: var(--primary-color);
            border-top: 2px solid #ccc;
            margin-top: 10px;
            padding-top: 10px;
        }
        
        /* فرم پرداخت */
        .checkout-form {
            max-width: 600px;
            margin: 30px auto;
            padding: 30px;
            background-color: var(--card-bg);
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        .checkout-form input {
            width: 100%;
            padding: 12px;
            margin-bottom: 20px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        .checkout-form label {
            display: block;
            margin-bottom: 5px;
            font-weight: 700;
        }

        /* ادمین پنل */
        .admin-panel, #login-form {
            max-width: 600px;
            margin: 30px auto;
        }

        .admin-panel input, .admin-panel textarea {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        
        .error-message {
            color: var(--danger-color);
            text-align: center;
            margin-top: 10px;
            font-weight: 700;
        }
    </style>
</head>
<body>

    <header class="navbar">
        <div class="logo" onclick="showPage('home')">فروشگاه Roham</div>
        <nav>
            <a onclick="showPage('home')">خانه</a>
            <a onclick="showPage('cart')">سبد خرید</a>
            <a onclick="showPage('admin')">پنل ادمین</a>
        </nav>
        <div class="user-actions">
            <button class="cart-btn btn" onclick="showPage('cart')">🛒 سبد خرید (<span id="cart-count">0</span>)</button>
        </div>
    </header>

    <main class="container">
        
        <section id="home-page" class="page-content active">
            <h2>محصولات ویژه</h2>
            <div id="product-list" class="product-grid">
                </div>
        </section>

        <section id="cart-page" class="page-content">
            <h2>سبد خرید شما</h2>
            <div id="cart-items-container">
                </div>
            
            <div id="cart-empty-message" style="text-align: center; display: none;">
                <p>سبد خرید شما خالی است.</p>
                <button class="btn btn-primary" onclick="showPage('home')">بازگشت به فروشگاه</button>
            </div>

            <div id="cart-summary" class="checkout-summary" style="display: none;">
                <div><span>مجموع کالاها:</span> <span id="subtotal">0 تومان</span></div>
                <div><span>هزینه ارسال:</span> <span id="shipping">0 تومان</span></div>
                <div class="total"><span>قابل پرداخت:</span> <span id="total-price">0 تومان</span></div>
                <button class="btn btn-success" style="width: 100%; margin-top: 20px;" onclick="showPage('checkout')">نهایی کردن خرید و پرداخت</button>
            </div>
        </section>
        
        <section id="checkout-page" class="page-content">
            <h2>تکمیل اطلاعات و پرداخت</h2>
            <div class="checkout-summary">
                <p>سفارش شما شامل <span id="checkout-count">0</span> کالا به مبلغ <span id="checkout-total">0 تومان</span> است.</p>
            </div>

            <form id="checkout-form" class="checkout-form">
                <h3>اطلاعات گیرنده</h3>
                <label for="checkout-name">نام کامل:</label>
                <input type="text" id="checkout-name" required>

                <label for="checkout-phone">شماره تماس:</label>
                <input type="tel" id="checkout-phone" required>

                <label for="checkout-address">آدرس کامل:</label>
                <input type="text" id="checkout-address" required>

                <button type="submit" class="btn btn-success" style="width: 100%; font-size: 1.2em;">پرداخت و ثبت نهایی (شبیه‌سازی)</button>
            </form>
        </section>

        <section id="admin-page" class="page-content admin-panel">
            <h2>پنل مدیریت</h2>

            <div id="admin-login-section">
                <form id="login-form">
                    <input type="password" id="admin-password" placeholder="رمز عبور ادمین (Rohamkhademi1390)" required>
                    <button type="submit" class="btn btn-primary">ورود</button>
                </form>
                <p id="login-message" class="error-message"></p>
            </div>

            <div id="admin-management-section" style="display: none;">
                <button class="btn btn-danger" style="float: left;" onclick="handleAdminLogout()">خروج</button>
                <h3>افزودن محصول جدید</h3>
                <form id="add-product-form" class="product-form">
                    <label for="prod-name">نام محصول:</label><input type="text" id="prod-name" required>
                    <label for="prod-price">قیمت (تومان):</label><input type="number" id="prod-price" required>
                    <label for="prod-image">لینک تصویر (URL):</label><input type="url" id="prod-image" value="https://via.placeholder.com/300x200?text=محصول+جدید">
                    <label for="prod-desc">توضیحات:</label><textarea id="prod-desc" rows="3"></textarea>
                    
                    <button type="submit" class="btn btn-primary">ثبت محصول</button>
                    <p id="product-message" class="error-message"></p>
                </form>

                <hr>
                <h3>لیست محصولات</h3>
                <ul id="admin-product-list" style="list-style: none;">
                    </ul>
            </div>
        </section>
        
        <section id="success-page" class="page-content" style="text-align: center; padding-top: 100px;">
            <h2 style="color: var(--success-color);">✅ پرداخت موفقیت‌آمیز بود!</h2>
            <p>سفارش شما با موفقیت ثبت شد و به زودی ارسال خواهد شد.</p>
            <p style="font-weight: 700; margin-top: 20px;">از خرید شما متشکریم.</p>
            <button class="btn btn-primary" onclick="showPage('home')" style="margin-top: 30px;">بازگشت به صفحه اصلی</button>
        </section>

    </main>

    <footer class="footer" style="text-align: center; padding: 20px; background-color: #333; color: white; margin-top: 50px;">
        <p>&copy; 2025 فروشگاه Roham - توسعه‌دهنده: شما</p>
    </footer>

    <script>
        // تعریف متغیرهای ثابت و داده‌ها
        const ADMIN_PASSWORD = "Rohamkhademi1390";
        const STORAGE_KEY_PRODUCTS = 'rohamStoreProducts';
        const STORAGE_KEY_CART = 'rohamStoreCart';

        // محصولات اولیه
        let products = JSON.parse(localStorage.getItem(STORAGE_KEY_PRODUCTS)) || [
            { id: 1, name: "لپ تاپ قدرتمند", price: 25000000, image: "https://via.placeholder.com/300x200?text=لپ+تاپ", description: "لپ تاپ نسل جدید با 32 گیگ رم." },
            { id: 2, name: "گوشی هوشمند", price: 12000000, image: "https://via.placeholder.com/300x200?text=موبایل", description: "گوشی پرچمدار با دوربین 108 مگاپیکسلی." },
            { id: 3, name: "هدفون بی‌سیم", price: 3500000, image: "https://via.placeholder.com/300x200?text=هدفون", description: "هدفون با قابلیت حذف نویز فعال." }
        ];

        // سبد خرید
        let cart = JSON.parse(localStorage.getItem(STORAGE_KEY_CART)) || [];
        
        // =======================================================
        // توابع اصلی (ناوبری و ذخیره‌سازی)
        // =======================================================

        function saveProducts() {
            localStorage.setItem(STORAGE_KEY_PRODUCTS, JSON.stringify(products));
        }

        function saveCart() {
            localStorage.setItem(STORAGE_KEY_CART, JSON.stringify(cart));
        }
        
        function formatPrice(price) {
            return price.toLocaleString('fa-IR') + ' تومان';
        }

        function showPage(pageId) {
            document.querySelectorAll('.page-content').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(`${pageId}-page`).classList.add('active');
            
            // رندر محتوای خاص هر صفحه
            if (pageId === 'home') {
                renderProducts();
            } else if (pageId === 'cart') {
                renderCart();
            } else if (pageId === 'checkout') {
                renderCheckoutSummary();
            } else if (pageId === 'admin') {
                checkAdminStatus();
            }
        }
        
        // =======================================================
        // منطق صفحه اصلی (Home)
        // =======================================================

        function renderProducts() {
            const productListElement = document.getElementById('product-list');
            productListElement.innerHTML = '';
            
            products.forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = 'product-card';
                productCard.innerHTML = `
                    <img src="${product.image}" alt="${product.name}">
                    <h3>${product.name}</h3>
                    <p class="price">${formatPrice(product.price)}</p>
                    <p style="padding: 0 15px; margin-bottom: 10px;">${product.description}</p>
                    <button class="btn btn-primary" onclick="addToCart(${product.id})">افزودن به سبد</button>
                `;
                productListElement.appendChild(productCard);
            });
        }
        
        // =======================================================
        // منطق سبد خرید (Cart) و Checkout
        // =======================================================

        function updateCartCount() {
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            document.getElementById('cart-count').textContent = totalItems;
            return totalItems;
        }

        function addToCart(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;
            
            const existingItem = cart.find(item => item.id === productId);

            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cart.push({ 
                    id: product.id, 
                    name: product.name, 
                    price: product.price, 
                    image: product.image,
                    quantity: 1 
                });
            }
            
            saveCart();
            updateCartCount();
            alert(`محصول "${product.name}" به سبد خرید اضافه شد.`);
        }

        function calculateCartTotals() {
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const shipping = subtotal > 5000000 ? 0 : 50000; // ارسال رایگان برای بالای 5 میلیون
            const total = subtotal + shipping;
            return { subtotal, shipping, total };
        }

        function renderCart() {
            const cartContainer = document.getElementById('cart-items-container');
            const totals = calculateCartTotals();
            const itemCount = updateCartCount();
            
            cartContainer.innerHTML = '';

            if (itemCount === 0) {
                document.getElementById('cart-empty-message').style.display = 'block';
                document.getElementById('cart-summary').style.display = 'none';
                return;
            }
            
            document.getElementById('cart-empty-message').style.display = 'none';
            document.getElementById('cart-summary').style.display = 'block';

            cart.forEach(item => {
                const cartItemElement = document.createElement('div');
                cartItemElement.className = 'cart-item';
                cartItemElement.innerHTML = `
                    <img src="${item.image}" alt="${item.name}">
                    <div class="item-info">
                        <h4>${item.name}</h4>
                        <p>${formatPrice(item.price)}</p>
                    </div>
                    <div class="item-quantity">
                        <button class="btn btn-danger" onclick="updateQuantity(${item.id}, -1)">-</button>
                        <input type="number" value="${item.quantity}" min="1" readonly>
                        <button class="btn btn-primary" onclick="updateQuantity(${item.id}, 1)">+</button>
                    </div>
                    <div style="width: 150px; text-align: left;">
                        ${formatPrice(item.price * item.quantity)}
                        <button class="btn btn-danger" style="margin-right: 15px;" onclick="removeFromCart(${item.id})">حذف</button>
                    </div>
                `;
                cartContainer.appendChild(cartItemElement);
            });

            document.getElementById('subtotal').textContent = formatPrice(totals.subtotal);
            document.getElementById('shipping').textContent = totals.shipping === 0 ? 'رایگان' : formatPrice(totals.shipping);
            document.getElementById('total-price').textContent = formatPrice(totals.total);
        }
        
        function updateQuantity(productId, change) {
            const item = cart.find(i => i.id === productId);
            if (item) {
                item.quantity += change;
                if (item.quantity <= 0) {
                    removeFromCart(productId);
                } else {
                    saveCart();
                    renderCart();
                }
            }
        }
        
        function removeFromCart(productId) {
            cart = cart.filter(item => item.id !== productId);
            saveCart();
            renderCart();
        }
        
        function renderCheckoutSummary() {
            const totals = calculateCartTotals();
            document.getElementById('checkout-count').textContent = updateCartCount();
            document.getElementById('checkout-total').textContent = formatPrice(totals.total);
            
            // اگر سبد خالی بود، به خانه برگردان
            if (updateCartCount() === 0) {
                showPage('home');
                alert("سبد خرید شما خالی است و نمی‌توانید پرداخت کنید.");
            }
        }
        
        // مدیریت نهایی کردن خرید (شبیه‌سازی تراکنش)
        document.getElementById('checkout-form').addEventListener('submit', function(e) {
            e.preventDefault();
            // در اینجا، اطلاعات آدرس و تماس می‌توانند به بک‌اند فرستاده شوند
            
            // شبیه‌سازی اتصال به درگاه پرداخت بانکی
            alert("در حال اتصال به درگاه پرداخت بانک...");
            
            // شبیه‌سازی پرداخت موفق
            setTimeout(() => {
                // ثبت سفارش و پاک کردن سبد خرید
                cart = [];
                saveCart();
                updateCartCount();
                
                showPage('success'); // نمایش صفحه موفقیت
            }, 2000);
        });

        // =======================================================
        // منطق پنل ادمین (Admin)
        // =======================================================
        
        function checkAdminStatus() {
            const loggedIn = localStorage.getItem('adminLoggedIn') === 'true';
            document.getElementById('admin-login-section').style.display = loggedIn ? 'none' : 'block';
            document.getElementById('admin-management-section').style.display = loggedIn ? 'block' : 'none';
            if (loggedIn) {
                renderAdminProducts();
            }
        }

        document.getElementById('login-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const password = document.getElementById('admin-password').value;
            const messageElement = document.getElementById('login-message');
            
            if (password === ADMIN_PASSWORD) {
                localStorage.setItem('adminLoggedIn', 'true');
                messageElement.textContent = "ورود موفقیت‌آمیز.";
                messageElement.style.color = 'var(--success-color)';
                checkAdminStatus();
            } else {
                messageElement.textContent = "❌ رمز عبور اشتباه است.";
                messageElement.style.color = 'var(--danger-color)';
            }
            document.getElementById('admin-password').value = '';
        });
        
        function handleAdminLogout() {
            localStorage.removeItem('adminLoggedIn');
            checkAdminStatus();
            alert("شما از پنل ادمین خارج شدید.");
        }

        document.getElementById('add-product-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const name = document.getElementById('prod-name').value;
            const price = parseInt(document.getElementById('prod-price').value);
            const image = document.getElementById('prod-image').value;
            const description = document.getElementById('prod-desc').value;
            const messageElement = document.getElementById('product-message');

            const newProduct = {
                id: Date.now(), // شناسه منحصر به فرد
                name,
                price,
                image,
                description
            };

            products.push(newProduct);
            saveProducts();
            
            // پاک کردن فرم
            e.target.reset();
            messageElement.textContent = `✅ محصول "${name}" با موفقیت اضافه شد.`;
            messageElement.style.color = 'var(--success-color)';
            setTimeout(() => messageElement.textContent = '', 3000);
            
            renderAdminProducts();
        });

        function renderAdminProducts() {
            const adminProductList = document.getElementById('admin-product-list');
            adminProductList.innerHTML = '';
            
            products.forEach((product, index) => {
                const listItem = document.createElement('li');
                listItem.style.cssText = 'display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px dashed #ccc;';
                listItem.innerHTML = `
                    <span>${index + 1}. ${product.name} - ${formatPrice(product.price)}</span>
                    <button class="btn btn-danger" style="padding: 5px 10px;" onclick="deleteProduct(${product.id})">حذف</button>
                `;
                adminProductList.appendChild(listItem);
            });
        }
        
        function deleteProduct(productId) {
            if (!confirm("آیا مطمئن هستید که می‌خواهید این محصول را حذف کنید؟")) return;
            
            products = products.filter(p => p.id !== productId);
            saveProducts();
            renderAdminProducts();
            alert("محصول حذف شد.");
        }

        // =======================================================
        // شروع برنامه
        // =======================================================
        window.onload = () => {
            updateCartCount();
            renderProducts();
            // اطمینان از نمایش صفحه خانه در ابتدا
            document.getElementById('home-page').classList.add('active');
        };
    </script>
</body>
</html>
